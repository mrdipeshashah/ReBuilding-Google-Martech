SELECT
  user_pseudo_id,
  event_name,
  (select value.string_value from unnest(event_params) where key = 'tag_category') as tag_category,
  (select value.string_value from unnest(event_params) where key = 'tag_name') as tag_name,
  (select value.string_value from unnest(event_params) where key = 'environment') as environment,
  ((select value.string_value from unnest(event_params) where key = 'domain')) as domain,
  ((select value.string_value from unnest(event_params) where key = 'continent')) as continent,
  ((select value.string_value from unnest(event_params) where key = 'country')) as country,  
  split((SELECT value.string_value FROM UNNEST(event_params) WHERE key = 'page_location'), '?')[SAFE_OFFSET(0)] AS page_location,
  (select timestamp_millis(value.int_value) from unnest(event_params) where key = 'timestamp') as event_timestamp,
  event_date,
  (select extract(month from timestamp_millis(value.int_value)) from unnest(event_params) where key = 'timestamp') as month,
  (select extract(day from timestamp_millis(value.int_value)) from unnest(event_params) where key = 'timestamp') as date,
  (select extract(year from timestamp_millis(value.int_value)) from unnest(event_params) where key = 'timestamp') as year,
  (select extract(hour from timestamp_millis(value.int_value)) from unnest(event_params) where key = 'timestamp') as hour,
  1 as count
FROM  `enter.tablename_123456.events_*`
WHERE
  (select value.string_value from unnest(event_params) where key = 'tag_category') = 'Error Page'
  OR 
  event_name = 'page_not_found'
